---
// src/layouts/GameLayout.astro
const { 
  title, 
  gameId, 
  gameScript = "", 
  canvasWidth = 1000, 
  canvasHeight = 600 
} = Astro.props;
---

<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>{title} üéÆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="/src/components/css/games.css" />
  <style is:global>
    /* RESET COMPLET */
    * { box-sizing: border-box; }
    body, html { 
      margin: 0; padding: 0; 
      height: 100vh; 
      background: radial-gradient(ellipse at top, #0a0a1f 0%, #000 70%);
      overflow: hidden; 
      color: white;
      font-family: system-ui, -apple-system, sans-serif;
    }

    /* HEADER SIMPLU - DOAR √éNAPOI + TITLU */
    .game-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 80px;
      padding: 1rem 2.5rem;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(30px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 30px rgba(0,0,0,0.6);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .header-title {
      margin: 0;
      font-size: clamp(1.6rem, 5vw, 2.5rem);
      font-weight: 900;
      letter-spacing: 0.03em;
      background: linear-gradient(135deg, #fff, rgba(255,255,255,0.7));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* MAIN VIEWPORT */
    .game-viewport {
      height: calc(100vh - 80px);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 10;
    }

    /* CANVAS/IFRAME CONTAINER */
    .canvas-container {
      position: relative;
      width: 95vw;
      max-width: 1400px;
      height: 75vh;
      max-height: 800px;
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 
        0 40px 120px rgba(0,0,0,0.8),
        0 0 0 1px rgba(255,255,255,0.1),
        inset 0 1px 0 rgba(255,255,255,0.1);
      background: rgba(15,15,25,0.6);
      backdrop-filter: blur(20px);
    }

    /* CANVAS */
    .canvas-container canvas {
      width: 100%;
      height: 100%;
      display: block;
      border-radius: 20px;
    }



/* === DISCLAIMER BANNER HIDE (FINAL) === */
.canvas-container::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 90px;
  background: linear-gradient(
    to bottom, 
    rgba(15,15,25,1) 0%, 
    rgba(15,15,25,0.95) 50%, 
    transparent 100%
  );
  z-index: 15;
  pointer-events: none;
}

.canvas-container iframe {
  position: absolute;
  top: -15px;
  left: 0; right: 0; bottom: 0;
  height: calc(100% + 15px);
  width: 100%;
  transform: scale(1.02);
}

@media (max-height: 500px) and (orientation: landscape) {
  .canvas-container::before { height: 110px; }
  .canvas-container iframe { top: -25px; }
}



    /* RESPONSIVE */
    @media (max-width: 768px) {
      .game-header { padding: 1rem 1.5rem; }
      .canvas-container { 
        width: 98vw; 
        height: 70vh; 
        border-radius: 16px;
      }
      .header-title { font-size: 1.8rem !important; }
    }
  </style>
</head>

<body>
  <!-- HEADER SIMPLIFICAT -->
  <header class="game-header">
    <button onclick="history.back()" class="btn-back">‚Üê</button>
    <h1 class="header-title">{title}</h1>
    <!-- ‚úÖ »òTERGE scor-badge -->
  </header>

  <!-- MAIN -->
  <main class="game-viewport">
    <div class="canvas-container">
      <!-- SLOT pentru IFRAME/CONTENT -->
      <slot />
      
      <!-- CANVAS FALLBACK pentru jocuri JS -->
      <canvas id={`canvas-${gameId}`} 
              width={canvasWidth} 
              height={canvasHeight}>
      </canvas>
    </div>
    <!-- ‚úÖ »òTERGE restart-trigger -->
  </main>

  <!-- GAME SCRIPT -->
  {gameScript && <script src={gameScript} is:inline></script>}

  <!-- GAME INIT SIMPLU -->
  <script define:vars={{ gameId }}>
    let gameAttempts = 0;
    
    function initGame() {
      gameAttempts++;
      const canvas = document.getElementById(`canvas-${gameId}`);
      const className = gameId.charAt(0).toUpperCase() + gameId.slice(1) + "Game";
      
      // CANVAS GAMES (Pong, Snake)
      if (window[className] && canvas && !window.currentGame) {
        window.currentGame = new window[className](gameId);
        window.currentGame.start();
        console.log(`‚úÖ ${title} pornit!`);
        return;
      }
      
      // RETRY pentru canvas games
      if (gameAttempts < 30) {
        setTimeout(initGame, 150);
      }
    }
    
    // ESC = Back
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') history.back();
    });
    
    window.addEventListener('load', initGame);
  </script>
  
</body>
</html>
